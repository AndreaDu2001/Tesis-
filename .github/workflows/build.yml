name: CI/CD - Build Frontend

on:
  push:
    branches:
      - main

jobs:
  build:
    runs-on: ubuntu-latest
    
    steps:
      - uses: actions/checkout@v4
      
      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '18.x'
          cache: 'npm'
          cache-dependency-path: 'frontend/package-lock.json'

      - name: Install dependencies
        working-directory: frontend
        run: npm install --legacy-peer-deps --no-optional

      - name: Build frontend
        working-directory: frontend
        run: npm run build
        env:
          REACT_APP_API_URL: https://epagal-backend-routing-latest.onrender.com
          CI: false

      - name: Verify build success
        working-directory: frontend
        run: |
          test -f build/index.html && echo "✅ Build successful"
          test -d build/static && echo "✅ Assets created"
          ls -la build/ | head -10

  notify:
    runs-on: ubuntu-latest
    needs: build
    if: success()
    
    steps:
      - name: Success notification
        run: |
          echo "## ✅ CI/CD Pipeline Success" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**Frontend**: Built successfully" >> $GITHUB_STEP_SUMMARY
          echo "**Commit**: ${{ github.sha }}" >> $GITHUB_STEP_SUMMARY
          echo "**Branch**: main" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "Render will auto-deploy this version to:" >> $GITHUB_STEP_SUMMARY
          echo "- https://tesis-1-z78t.onrender.com" >> $GITHUB_STEP_SUMMARY
